<!DOCTYPE html>
<html 
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org "
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
	<head lang="en">
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<title>Dermalif | Starter</title>
		<!-- Tell the browser to be responsive to screen width -->
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
		<!-- Bootstrap 3.3.6 -->
		<link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.min.css}"/>
		<!-- Font Awesome -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
		<!-- Ionicons -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css"/>
		<!-- DataTables -->
  		<link rel="stylesheet" th:href="@{/plugins/datatables/dataTables.bootstrap.css}"/>
  		<!-- bootstrap datepicker -->
  		<link rel="stylesheet" th:href="@{/plugins/datepicker/datepicker3.css}"/>
  		<!-- Select2 -->
  		<link rel="stylesheet" th:href="@{/plugins/select2/select2.min.css}"/>
  		 <!--Bootstrap time Picker -->
  		<link rel="stylesheet" th:href="@{/plugins/timepicker/bootstrap-timepicker.min.css}"/>
  		<!-- fullCalendar 2.2.5-->
		<link rel="stylesheet" th:href="@{/plugins/fullcalendar/fullcalendar.min.css}"/>
		<link rel="stylesheet" th:href="@{/plugins/fullcalendar/fullcalendar.print.css}" media="print"/>
		<!-- Theme style -->
		<link rel="stylesheet" th:href="@{/dist/css/AdminLTE.min.css}"/>
		<!-- AdminLTE Skins. We have chosen the skin-blue for this starter
		      page. However, you can choose any other skin. Make sure you
		      apply the skin class to the body tag so the changes take effect.
		-->
		<link rel="stylesheet" th:href="@{/dist/css/skins/skin-purple.min.css}"/>	
		<link rel="stylesheet" th:href="@{/dist/css/myStyle.css}"/>			
		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>

	<body class="hold-transition skin-purple sidebar-mini ">
		<div class="wrapper">
			<!-- Main Header -->
			<header class="main-header">
			    <!-- Logo -->
			    <a href="#" th:href="@{/home}" class="logo">
			      <!-- mini logo for sidebar mini 50x50 pixels -->
			      <span class="logo-mini"><b>D</b>Lif</span>
			      <!-- logo for regular state and mobile devices -->
			      <span class="logo-lg"><b>Derma</b>Lif</span>
			    </a>			
			    <!-- Header Navbar -->
			    <nav class="navbar navbar-static-top" role="navigation">
			      <!-- Sidebar toggle button-->
			      <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
			        <span class="sr-only">Toggle navigation</span>
			      </a>
			      <!-- Navbar Right Menu -->
			      <div class="navbar-custom-menu">
			        <ul class="nav navbar-nav">
			          <!-- User Account Menu -->
			          <li class="dropdown user user-menu">
			            <!-- Menu Toggle Button -->
			            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
			              <!-- The user image in the navbar-->
			              <img th:src="@{'/user/files?filename='+${personsecurity.id}}" class="user-image" alt="User Image"/>
			              <!-- hidden-xs hides the username on small devices so only the image appears. -->
			              <span class="hidden-xs" th:text="${personsecurity.firstname+' '+personsecurity.lastname}"></span>
			            </a>
			            <ul class="dropdown-menu">
			              <!-- The user image in the menu -->
			              <li class="user-header">
			                <img th:src="@{'/user/files?filename='+${personsecurity.id}}" class="img-circle" alt="User Image"/>			
			                <p>
			                  <span th:text="${personsecurity.firstname+' '+personsecurity.lastname}"></span>
			                </p>
			              </li>
			              <!-- Menu Footer-->
			              <li class="user-footer">
			                <div class="pull-left">
			                  <a href="#" th:href="@{/user/perfil}" class="btn btn-default btn-flat">Perfil</a>
			                </div>
			                <div class="pull-right">
			                  <a href="#" data-toggle="modal" data-target="#modalexit" class="btn btn-default btn-flat">Salir</a>
			                </div>
			              </li>
			            </ul>
			          </li>
			          <!-- Control Sidebar Toggle Button -->
			        </ul>
			      </div>
			    </nav>
			  </header>
			<!-- Left side column. contains the logo and sidebar -->
			  <aside class="main-sidebar" >			
			    <!-- sidebar: style can be found in sidebar.less -->
			    <section class="sidebar">			
			      <!-- Sidebar user panel (optional) -->
			      <div class="user-panel">
			        <div class="pull-left image">
			          <img th:src="@{'/user/files?filename='+${personsecurity.id}}" class="img-circle" alt="User Image"/>
			        </div>
			        <div class="pull-left info">
			          <p><span th:text="${personsecurity.firstname}"></span></p>
			          <!-- Status -->
			          <a href="#"><i class="fa fa-circle text-success"></i> Online</a>
			        </div>
			      </div>			
			      <!-- search form (Optional)
			      <form action="#" method="get" class="sidebar-form">
			        <div class="input-group">
			          <input type="text" name="q" class="form-control" placeholder="Search..."/>
			              <span class="input-group-btn">
			                <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i>
			                </button>
			              </span>
			        </div>
			      </form>-->
			      <!-- /.search form -->
			      <!-- Sidebar Menu -->
			      <ul class="sidebar-menu">
			        <li class="header">MODULOS</li>
			        <!-- Optionally, you can add icons to the links -->      			         
			        <li class="treeview" th:classappend="${lvm.modulo}=='ADMISIONES' ? active">
			          <a href="#"><i class="fa fa-address-card-o"></i> <span>Admisiones</span>
			            <span class="pull-right-container">
			              <i class="fa fa-angle-left pull-right"></i>
			            </span>
			          </a>
			          <ul class="treeview-menu">
				          <li th:classappend="${lvm.ubicacion}==${T(com.pl10.dermalif.constant.HrefConstant).HREF_USUARIOS} ? active">
				          	<a href="#" th:href="@{/user}"><i class="fa fa-user-o"></i>Usuarios</a>
				          </li>
				          <li th:classappend="${lvm.ubicacion}==${T(com.pl10.dermalif.constant.HrefConstant).HREF_CITAS} ? active">
				          	<a href="#" th:href="@{/user/citas}"><i class="fa fa-calendar-o"></i>Citas</a>
				          </li>
				          <li th:classappend="${lvm.ubicacion}==${T(com.pl10.dermalif.constant.HrefConstant).HREF_INGRESO} ? active">
				          	<a href="#" th:href="@{/user/ingresosview?result=2}"><i class="fa fa-folder-open-o"></i>Ingresos</a>
				          </li>
			          </ul>
			        </li>
			       <li class="treeview" th:classappend="${lvm.modulo}=='HISTORIA' ? active">
			          <a href="#"><i class="fa fa-hospital-o"></i> <span>Historial</span>
			            <span class="pull-right-container">
			              <i class="fa fa-angle-left pull-right"></i>
			            </span>
			          </a>
			          <ul class="treeview-menu">
				        <li th:classappend="${lvm.ubicacion}==${T(com.pl10.dermalif.constant.HrefConstant).HREF_USERHISTORY} ? active">
				        	<a href="#" th:href="@{/historia/userhistory}"><i class="fa fa-h-square"></i>Archivo Clinico</a>
				       	</li>
			          </ul>
			        </li>
			        <li class="treeview" th:classappend="${lvm.modulo}=='FACTURACIÓN' ? active">
			          <a href="#"><i class="fa fa-money"></i> <span>Facturación</span>
			            <span class="pull-right-container">
			              <i class="fa fa-angle-left pull-right"></i>
			            </span>
			          </a>
			          <ul class="treeview-menu">
			          	<li th:classappend="${lvm.ubicacion}==${T(com.pl10.dermalif.constant.HrefConstant).HREF_FACTINGR} ? active">
			            	<a href="#" th:href="@{/factura/ingresos?result=0}"><i class="fa fa-file-text-o"></i>Facturas</a>
			           	</li>
			            <li th:classappend="${lvm.ubicacion}==${T(com.pl10.dermalif.constant.HrefConstant).HREF_NEWARTICULO} ? active">
			            	<a href="#" th:href="@{/factura/articulo}"><i class="fa fa-plus-square-o"></i>Articulos</a>
			           	</li>
			          </ul>
			        </li>
			        <li class="treeview" th:classappend="${lvm.modulo}=='PERFIL' ? active">
			        	<a href="#" th:href="@{/user/perfil}"><i class="fa fa-user-circle-o"></i> <span>Perfil de usuario</span></a>
			       	</li>			       	
			        <li><a href="#" data-toggle="modal" data-target="#modalexit">
			        	<i class="fa fa-sign-out"></i> <span>Salir</span></a>
			       	</li> 
			      </ul>
			      <!-- /.sidebar-menu -->
			    </section>
			    <!-- /.sidebar -->
			  </aside>	
			  <!-- Content Wrapper. Contains page content -->
			  
			  
			  
			  <div class="modal fade" id="modalexit" role="dialog">
			    <div class="modal-dialog">
			    
			      <!-- Modal content-->
			      <div class="modal-content">
			        <div class="modal-header">
			          <button type="button" class="close" data-dismiss="modal">&times;</button>
			          <h4 class="modal-title">Salir del sistema</h4>
			        </div>
			        <div class="modal-body">
			          <p>¿Realmente desea salir del sistema?</p>
			        </div>
			        <div class="modal-footer">
			        	<div class="row">			        		
			        		<div class="col-md-4">
			        			<form th:action="@{/logout}" method="POST">
			        				<button class="btn btn-primary pull-left" type="submit">Si</button>
			        			</form>
			        		</div>
			        		<div class="col-md-4"></div>
			        		<div class="col-md-4"><button type="button" class=" btn btn-default" data-dismiss="modal">No</button></div>
			        	</div>
			        </div>
			      </div>
			      
			    </div>
			  </div>
			  
			  
		  	<div class="content-wrapper">
		    	<!-- Content Header (Page header) -->
		    	<section class="content-header">
		      		<h1><span th:text="${lvm.modulo}+' '+${lvm.ubicacion}"></span>
		        		<small th:text="${lvm.descripcion}"></small>
		      		</h1>
		    	</section>
		    	<!-- Main content -->
		    	<section class="content">
					<div layout:fragment="page-content">
					
					
					<!-- AQUI VA EL CONTENIDO -->
					
					
					</div>		
		    	</section>
		    	<!-- /.content -->
		  	</div>
		  	<!-- /.content-wrapper -->
		  	<!-- Main Footer -->
		  	<footer class="main-footer" >
			    <!-- To the right -->
			    <div class="pull-right hidden-xs">
			      Software de historias clínicas
			    </div>
			    <!-- Default to the left -->
			    <strong>Copyright &copy; 2017 <a href="http://pl10.com.co/" target="_blank">PL10</a></strong> Todos los derechos reservados.
			  </footer>
		</div>
		<!-- ./wrapper -->
		<!-- REQUIRED JS SCRIPTS -->
		<!-- jQuery 2.2.3 -->
		<script th:src="@{/plugins/jQuery/jquery-2.2.3.min.js}"></script>
		<!-- Bootstrap 3.3.6 -->
		<script th:src="@{/bootstrap/js/bootstrap.min.js}"></script>		
		<!-- DataTables -->
		<script th:src="@{/plugins/datatables/jquery.dataTables.min.js}"></script>
		<script th:src="@{/plugins/datatables/dataTables.bootstrap.min.js}"></script>		
		<!-- bootstrap datepicker -->
		<script th:src="@{/plugins/datepicker/bootstrap-datepicker.js}"></script>
		<!-- FastClick -->
		<script th:src="@{/plugins/fastclick/fastclick.js}"></script>		
		<!-- select2 -->
		<script th:src="@{/plugins/select2/select2.full.min.js}"></script>
		 <!--fullCalendar 2.2.5 -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
		<script th:src="@{/plugins/fullcalendar/fullcalendar.min.js}"></script>
		<!-- bootstrap time picker -->
		<script th:src="@{/plugins/timepicker/bootstrap-timepicker.min.js}"></script>
		<!-- notifyjs -->
		<script th:src="@{/plugins/notifyjs/notify.min.js}"></script>
		
		<!-- AdminLTE App -->
		<script th:src="@{/dist/js/app.min.js}"></script>
		<!-- Optionally, you can add Slimscroll and FastClick plugins.
		     Both of these plugins are recommended to enhance the
		     user experience. Slimscroll is required when using the
		     fixed layout. -->
		     
		     <script>
		     
			   //Plug-in to fetch page data 
			 	jQuery.fn.dataTableExt.oApi.fnPagingInfo = function ( oSettings )
			 	{
			 		return {
			 			"iStart":         oSettings._iDisplayStart,
			 			"iEnd":           oSettings.fnDisplayEnd(),
			 			"iLength":        oSettings._iDisplayLength,
			 			"iTotal":         oSettings.fnRecordsTotal(),
			 			"iFilteredTotal": oSettings.fnRecordsDisplay(),
			 			"iPage":          oSettings._iDisplayLength === -1 ?
			 				0 : Math.ceil( oSettings._iDisplayStart / oSettings._iDisplayLength ),
			 			"iTotalPages":    oSettings._iDisplayLength === -1 ?
			 				0 : Math.ceil( oSettings.fnRecordsDisplay() / oSettings._iDisplayLength )
			 		};
			 	};
		     
		     //var data = [{ 'id': 0, 'text': 'enhancement' }];
				

					
					jQuery("#ciudad1").select2({
		  				language: "es",
		  	            placeholder: 'Seleccione',
		  	          	minimumInputLength:'2',
		  	            ajax: {
		  	            	delay: 250,
		    				url: function (params) {
		    					return '/dermalif/user/search/city';
		    				},
		    				data: function (params) {
		    					var queryParameters = {
		    					 	searchString: params.term
		    					}
		    					return queryParameters;
		    				},
		    				processResults: function (data) {
		    					return {
		    						results: data
		    					};
		    				},
		    				cache: true,
		  	            }
					});
					
					jQuery("#ciudad2").select2({
		  				language: "es",
		  	            placeholder: 'Seleccione',
		  	          	minimumInputLength:'2',
		  	            ajax: {
		  	            	delay: 250,
		    				url: function (params) {
		    					return '/dermalif/user/search/city';
		    				},
		    				data: function (params) {
		    					var queryParameters = {
		    					 	searchString: params.term
		    					}
		    					return queryParameters;
		    				},
		    				processResults: function (data) {
		    					return {		    						
		    						results: data
		    					};
		    				},
		    				cache: true,
		  	            }
					});
					
					jQuery("#articulo").select2({
		  				language: "es",
		  	            placeholder: 'Seleccione',
		  	          	minimumInputLength:'2',
		  	            ajax: {
		  	            	delay: 250,
		    				url: function (params) {
		    					return '/dermalif/factura/search/articulo';
		    				},
		    				data: function (params) {
		    					var queryParameters = {
		    					 	searchString: params.term
		    					}
		    					return queryParameters;
		    				},
		    				processResults: function (data) {
		    					return {		    						
		    						results: data
		    					};
		    				},
		    				cache: true,
		  	            }
					}).on('change', function(){
						var idArticulo = this.value;
						$.get("/dermalif/factura/search/articulo/id?id="+idArticulo, function(data){
							$("#fact-valor-product").val(data.valor);
						});
					});
					
					
					$('#useradmision').DataTable({
						"lengthChange": false,  
						"ordering": false,
					      "autoWidth": true,					      
							"bProcessing": true,
							"bServerSide": true,
							"sort": "position",
							"bStateSave": false,
							//"iDisplayLength": 10,
							"iDisplayStart": 0,
							"fnDrawCallback": function () {
							},
							"sAjaxSource": "/dermalif/user/alluser",							
							"aoColumns": [
					            //{ "mData": "ndocumento" },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           			return data.tdocumento+' - '+data.ndocumento;
					            	}
					            },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           			return data.firstname+' '+data.firstname2;
					            	}
					            },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           			return data.lastname+' '+data.lastname2;
					            	}
					            },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           		return '<a href="/dermalif/user/usuarioform?id='+ data.id +'"><span class="btn btn-block btn-primary btn-xs">Editar</span></a>';
					            	}
					            },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           		return '<a href="/dermalif/user/ingresoform?id='+ data.id +'"><span class="btn btn-block btn-default btn-xs">Ingresar</span></a>';
					            	}
					            },
					        ]
					    });
					
					$('#ingresos').DataTable({
						"lengthChange": false,  
						"responsive": true,
						"ordering": false,
					      "autoWidth": true,					      
							"bProcessing": true,
							"bServerSide": true,
							"sort": "position",
							"bStateSave": false,
							//"iDisplayLength": 10,
							"iDisplayStart": 0,
							"fnDrawCallback": function () {
							},
							"sAjaxSource": "/dermalif/user/allingresos",	
							"aoColumns": [
								{ "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           			return 'NO'+data.norden;
					            	}
					            },
					            { "mData": null, 
					            	"bSortable": false,
					            	"mRender": function(data) {
					            		return data.fechaFormat;
					            	}
					            },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           			return data.personModel.tdocumento+' - '+data.personModel.ndocumento;
					            	}
					            },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           			return data.personModel.firstname+' '+data.personModel.lastname;
					            	}
					            },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					            		var retorno = "";
					            		if(data.tstatus=='INGRESADO'){
					            			retorno = '<span class="label-default label">'+data.tstatus+'</span>';
					            		}else if(data.tstatus=='EN_CURSO'){
					            			retorno = '<span class="label-primary label">'+data.tstatus+'</span>';
					            		}else if(data.tstatus=='FACTURADO'){
					            			retorno = '<span class="label-success label">'+data.tstatus+'</span>';
					            		}else if(data.tstatus=='FINALIZADO'){
					            			retorno = '<span class="label-info label">'+data.tstatus+'</span>';
					            		}else if(data.tstatus=='ANULADO'){
					            			retorno = '<span class="label-warning label">'+data.tstatus+'</span>';
					            		}
					           			return retorno;
					            	}
					            
					            },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					            		var div = "";
					            		div += '<div class="dropdown">';
					            		div += '<button class="btn btn-default dropdown-toggle btn-xs" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">Acciones <span class="caret"></span></button>';
					            		div += '<ul class="dropdown-menu" aria-labelledby="dropdownMenu1">';
					            		div += '<li><a href="/dermalif/historia/hcform?id='+data.id+'">Historia</a></li>';
					            		div += '<li><a data-toggle="modal" href="#myModalFactura" data-id="'+ data.id +'" class="open-Modal-fact">Facturar</a></li>';
					            		div += '<li><a data-toggle="modal" data-id="'+ data.id +'" href="#myModal" class="open-Modal">Hora</a></li>';
					            		div += '<li><a data-toggle="modal" data-id="'+ data.id +'" href="#myModalanula" class="open-Modal-anulaing">Anular</a></li>';
					            		div += '</ul>';
					            		div += '</div>';					            		
					            		return 	div;
					            	}
					            },
					        ]
					    });
					
					$('#userhistoria').DataTable({
						"lengthChange": false,  
						"ordering": false,
					      "autoWidth": true,					      
							"bProcessing": true,
							"bServerSide": true,
							"sort": "position",
							"bStateSave": false,
							//"iDisplayLength": 10,
							"iDisplayStart": 0,
							"fnDrawCallback": function () {
							},
							"sAjaxSource": "/dermalif/historia/alluser",							
							"aoColumns": [
					            //{ "mData": "ndocumento" },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           			return data.tdocumento+' - '+data.ndocumento;
					            	}
					            },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           			return data.firstname+' '+data.firstname2;
					            	}
					            },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           			return data.lastname+' '+data.lastname2;
					            	}
					            },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           		return '<a href="/dermalif/historia/historybyuser?id='+ data.id +'"><span class="btn btn-block btn-primary btn-xs">Ver Historias</span></a>';
					            	}
					            },
					            
					        ]
					    });
					
					$('#articulotable').DataTable({
						"lengthChange": false,  
						"ordering": false,
					      "autoWidth": true,					      
							"bProcessing": true,
							"bServerSide": true,
							"sort": "position",
							"bStateSave": false,
							//"iDisplayLength": 10,
							"iDisplayStart": 0,
							"fnDrawCallback": function () {
							},
							"sAjaxSource": "/dermalif/factura/allarticulo",							
							"aoColumns": [
					            { "mData": "codigo" },
					            { "mData": "name"  	},
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           			return '$'+data.valor;
					            	}
					            },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					            		var retorno = "";
					            		if(data.enable==true){
					            			retorno = '<span class="label-info label">ACTIVO</span>';
					            		}else if(data.enable==false){
					            			retorno = '<span class="label-warning label">INACTIVO</span>';
					            		}
					           			return retorno;
					            	}
					            },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           		return '<a href="/dermalif/factura/newformarticulo?id='+ data.id +'"><span class="btn btn-block btn-default btn-xs">Editar</span></a>';
					            	}
					            },
					        ]
					    });
					
					$('#factura').DataTable({
						"lengthChange": false,  
						"ordering": false,
					      "autoWidth": true,					      
							"bProcessing": true,
							"bServerSide": true,
							"sort": "position",
							"bStateSave": false,
							//"iDisplayLength": 10,
							"iDisplayStart": 0,
							"fnDrawCallback": function () {
							},
							"sAjaxSource": "/dermalif/factura/allfactura",							
							"aoColumns": [
					            { "mData": "norden" },
					            { "mData": "name"  	},//aki va factura
					            { "mData": "fechaformat"		},
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           			return data.personModel.tdocumento+' - '+data.personModel.ndocumento;
					            	}
					            },
					            { "mData": null,
					            	"bSortable": false,
					            	"mRender": function(data) {
					           			return data.personModel.firstname+' '+data.personModel.lastname;
					            	}
					            },
					        ]
					    });
					
					$(document).on("click", ".open-Modal", function () {
						var myDNI = $(this).data('id');
						$(".modal-body #DNI").val( myDNI );						
						});
					
					$(document).on("click", ".open-Modal-fact", function () {
						var myDNI = $(this).data('id');						
						$(".modal-body #idIngreso").val( myDNI );
						$.get('/dermalif/factura/getconsecutivo').done(function(data) {		
							$(".modal-body #idFact").val( data );
					   });
					});
						
					$(document).on("click", ".open-Modal-anulaing", function () {
						var myDNI = $(this).data('id');
						$(".modal-body #idIngreso").val( myDNI );						
						});
					
					var counter = $("#table-factura tr").length;;
					  $("#addrow").on("click", function () {
						  try{
							  if($("#fact-cant-product").val()>0){
								  var articulo = $('#articulo').select2('data');
								  var factura = facturar($("#fact-cant-product").val(),$("#fact-valor-product").val() );	
								  $.get('/dermalif/factura/addarticulo', {
									  id: articulo[0].id,
									  idf: $("#idfactura").val(),
									  cantidad: factura.cantidadf,
									  valorart: factura.valorf,
									  importe: factura.importef,
									  iva: $("#fact-iva").val(),
								  }).done(function(data) {
									  crearcelda(data, articulo, factura);
								  });									  
							  }else{
								  $.notify("Agregue una cantidad", "error");
							  }
						  }catch(e){
							  $.notify(e, "error");
						  }						 
					  });
					  
					  $("table.table-striped").on("click", ".ibtnDel", function (event) {					       
					      var row =  $(this).closest("tr");
					      var tds = row.find('td');
					      $.get('/dermalif/factura/removearticulo', {
							  id: tds[5].innerText,
						  }).done(function(data) {
							  	eliminarCelda(data, row);
							  						  
						  });					      
					        
					    });
	
					  function crearcelda(data, articulo, factura){
						  if(!data == ''){
								  var newRow = $("<tr>");
								  var cols = "";
								  cols += '<td><span name="cant' + counter + '">'+ factura.cantidadf +'</span></td>';
								  cols += '<td><span name="desc' + counter + '">'+ articulo[0].text +'</span></td>';				  
								  cols += '<td><span name="valor' + counter + '">'+ factura.valorf +'</span></td>';		
								  cols += '<td><span name="importe' + counter + '">'+ factura.importef +'</span></td>';
								  cols += '<td><input type="button" class="ibtnDel btn btn-xs btn-danger "  value="Borrar"/></td>';
								  cols += '<td style="display:none;"><span name="idfactdesc' + counter + '">'+ data +'</span></td></tr>';
								  newRow.append(cols);					  
								  $("table.table-striped").append(newRow);
								  counter++;
								  $("#fact-subtotal-var").val(factura.subtotalf);
								  $("#fact-subtotal").text(factura.subtotalf);
								  $("#fact-total-var").val(factura.totalf);
								  $("#fact-total").text(factura.totalf);
							  }else{
								  $.notify("Error!!", "error");
							  }
					  }
					  
					  function eliminarCelda(data, row){	
						  var tds = row.find('td');
						  if(data == 'OK'){
							  var factura = recalcular(tds[3].innerText);
						      $("#fact-subtotal-var").val(factura.subtotalf);
							  $("#fact-subtotal").text(factura.subtotalf);
							  $("#fact-total-var").val(factura.totalf);
							  $("#fact-total").text(factura.totalf)
							  row.remove();       
						      	counter -= 1;
						  }
					  }
				
				function facturar(cant, valor){
					var importe = cant * valor;
					var subtotal = $("#fact-subtotal-var").val();
					var iva = $("#fact-iva").val();
					var total = $("#fact-total-var").val();
					total = parseFloat(importe) + parseFloat(total);
					iva = (iva/100) * total;
					subtotal = total - iva;
					
					var Factura = {cantidadf: cant,
							valorf: valor,
							importef: importe,
							totalf: total,
							subtotalf: subtotal};			
					return Factura;					
				}
				
				function recalcular(importe){
					var subtotal = $("#fact-subtotal-var").val();
					var iva = $("#fact-iva").val();
					var total = $("#fact-total-var").val();
					total = parseFloat(total) - parseFloat(importe);
					iva = (iva/100) * total;
					subtotal = total - iva;
					
					var Factura = {cantidadf: 0,
							valorf: 0,
							importef: importe,
							totalf: total,
							subtotalf: subtotal};			
					return Factura;					
				}	
					
					var countChecked = function() {
						var n = false;
						if ($('input[name=rolepac]').is(':checked')==true){
							n = true;
						}
						if ($('input[name=rolefac]').is(':checked')==true){
							n = true;
						}
						if ($('input[name=roledoc]').is(':checked')==true){
							n = true;
						}
						if ($('input[name=rolehcl]').is(':checked')==true){
							n = true;
						}
						if ($('input[name=roleing]').is(':checked')==true){
							n = true;
						}
						if ($('input[name=rolecit]').is(':checked')==true){
							n = true;
						}							
						$('input[name=rolesys]').prop('checked', n);
						
					};
					jQuery('input[name=rolepac]').on("click", countChecked);
					jQuery('input[name=rolefac]').on("click", countChecked);
					jQuery('input[name=roledoc]').on("click", countChecked);
					jQuery('input[name=rolehcl]').on("click", countChecked);
					jQuery('input[name=roleing]').on("click", countChecked);
					jQuery('input[name=rolecit]').on("click", countChecked);
					jQuery('input[name=rolesys]').on("click", function(){
						if ($('input[name=rolesys]').is(':checked')==false){
							$('input[name=rolepac]').prop('checked', false);
							$('input[name=rolefac]').prop('checked', false);
							$('input[name=roledoc]').prop('checked', false);
							$('input[name=rolehcl]').prop('checked', false);
							$('input[name=roleing]').prop('checked', false);
							$('input[name=rolecit]').prop('checked', false);
						}
					});
					
					jQuery('input[name=rolesys]').change(function() {
						var value = $('input[name=rolesys]').is(':checked');	
						var personrol = $('input[name=personrolid]').val();
						jQuery.ajax({
							url: '/dermalif/user/addrole',
							data: { 
						        "value": value, 
						        "personrol": personrol,
						        "tprol": 'rolesys',
						        "rolesys": $('input[name=rolesys]').is(':checked'),
						    },							
						});
					});
					jQuery('input[name=rolepac]').change(function() {
						var value = $('input[name=rolepac]').is(':checked');	
						var personrol = $('input[name=personrolid]').val();
						jQuery.ajax({
							url: '/dermalif/user/addrole',
							data: { 
						        "value": value, 
						        "personrol": personrol,
						        "tprol": 'rolepac',
						        "rolesys": $('input[name=rolesys]').is(':checked'),
						    },							
						});
					});
					jQuery('input[name=rolefac]').change(function() {
						var value = $('input[name=rolefac]').is(':checked');	
						var personrol = $('input[name=personrolid]').val();
						jQuery.ajax({
							url: '/dermalif/user/addrole',
							data: { 
						        "value": value, 
						        "personrol": personrol,
						        "tprol": 'rolefac',
						        "rolesys": $('input[name=rolesys]').is(':checked'),
						    },							
						});
					});
					jQuery('input[name=roledoc]').change(function() {
						var value = $('input[name=roledoc]').is(':checked');	
						var personrol = $('input[name=personrolid]').val();
						jQuery.ajax({
							url: '/dermalif/user/addrole',
							data: { 
						        "value": value, 
						        "personrol": personrol,
						        "tprol": 'roledoc',
						        "rolesys": $('input[name=rolesys]').is(':checked'),
						    },							
						});
					});
					jQuery('input[name=rolehcl]').change(function() {
						var value = $('input[name=rolehcl]').is(':checked');	
						var personrol = $('input[name=personrolid]').val();
						jQuery.ajax({
							url: '/dermalif/user/addrole',
							data: { 
						        "value": value, 
						        "personrol": personrol,
						        "tprol": 'rolehcl',
						        "rolesys": $('input[name=rolesys]').is(':checked'),
						    },							
						});
					});
					jQuery('input[name=roleing]').change(function() {
						var value = $('input[name=roleing]').is(':checked');	
						var personrol = $('input[name=personrolid]').val();
						jQuery.ajax({
							url: '/dermalif/user/addrole',
							data: { 
						        "value": value, 
						        "personrol": personrol,
						        "tprol": 'roleing',
						        "rolesys": $('input[name=rolesys]').is(':checked'),
						    },							
						});
					});
					jQuery('input[name=rolecit]').change(function() {
						var value = $('input[name=rolecit]').is(':checked');	
						var personrol = $('input[name=personrolid]').val();
						jQuery.ajax({
							url: '/dermalif/user/addrole',
							data: { 
						        "value": value, 
						        "personrol": personrol,
						        "tprol": 'rolecit',
						        "rolesys": $('input[name=rolesys]').is(':checked'),
						    },							
						});
					});
					
			  
		  $('#example2').DataTable({
		      "paging": false,
		      "lengthChange": false,
		      "searching": false,
		      "ordering": false,
		      "info": false,
		      "autoWidth": true
		    });
		  
		  
		    $('#example1').DataTable({
		      "paging": true,
		      "lengthChange": true,
		      "searching": true,
		      "ordering": false,
		      "info": true,
		      "autoWidth": true
		    });
		    
		  	//Date picker
		    $('#datepicker').datepicker({
		      autoclose: true,
		      format: 'dd/mm/yyyy'
		      
		    });
		  	
		  	///Initialize Select2 Elements
		    //$(".select2").select2();
		  	
		  	//Timepicker
		    $(".timepicker").timepicker({
		      showInputs: false
		    });
		  	
		    /* initialize the calendar
		     -----------------------------------------------------------------*/
		    //Date for the calendar events (dummy data)
		    var date = new Date();
		    var d = date.getDate(),
		        m = date.getMonth(),
		        y = date.getFullYear();
			$('#calendar').fullCalendar({
				defaultView: 'agendaDay',
				slotDuration: '00:15:00',
				header: {
			        left: 'prev,next today',
			        center: 'title',
			        right: 'month,agendaWeek,agendaDay'
			      },
			      buttonText: {
			        today: 'hoy',
			        month: 'mes',
			        week: 'semana',
			        day: 'día'
			      },
			      
			      //Random default events
			      events: [
			        {
			          title: 'CC 10256998 - Jose Fuentes',
			          start: new Date(y, m, 23, 11, 00),
			          end: new Date(y, m, 23, 11, 20),
			          backgroundColor: "#f56954", //red
			          borderColor: "#f56954" //red
			        },
			        {
			          title: 'Long Event',
			          start: new Date(y, m, d - 5),
			          end: new Date(y, m, d - 2),
			          backgroundColor: "#f39c12", //yellow
			          borderColor: "#f39c12" //yellow
			        },
			        {
			          title: 'Meeting',
			          start: new Date(y, m, d, 10, 30),
			          allDay: false,
			          backgroundColor: "#0073b7", //Blue
			          borderColor: "#0073b7" //Blue
			        },
			        {
			          title: 'Lunch',
			          start: new Date(y, m, d, 12, 0),
			          end: new Date(y, m, d, 14, 0),
			          allDay: false,
			          backgroundColor: "#00c0ef", //Info (aqua)
			          borderColor: "#00c0ef" //Info (aqua)
			        },
			        {
			          title: 'Birthday Party',
			          start: new Date(y, m, d + 1, 19, 0),
			          end: new Date(y, m, d + 1, 22, 30),
			          allDay: false,
			          backgroundColor: "#00a65a", //Success (green)
			          borderColor: "#00a65a" //Success (green)
			        },
			        {
			          title: 'Click for Google',
			          start: new Date(y, m, 28),
			          end: new Date(y, m, 29),
			          url: 'http://google.com/',
			          backgroundColor: "#3c8dbc", //Primary (light-blue)
			          borderColor: "#3c8dbc" //Primary (light-blue)
			        }
			      ],
			      editable: false,
			      droppable: false // this allows things to be dropped onto the calendar !!!
			      
			});
			
			 

		  
		</script>
	</body>
</html>
